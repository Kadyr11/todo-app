# üöÄ DOCKER –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø –ó–ê–í–ï–†–®–ï–ù–ê!

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è Dockerfile

### üîß –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:

1. **–ú–Ω–æ–≥–æ—ç—Ç–∞–ø–Ω–∞—è —Å–±–æ—Ä–∫–∞ (Multi-stage build)**
   - ‚úÖ –û—Ç–¥–µ–ª–µ–Ω —ç—Ç–∞–ø —Å–±–æ—Ä–∫–∏ (`builder`) –æ—Ç production (`runtime`)
   - ‚úÖ Dev-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Å—Ç–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ builder-—Å—Ç–∞–¥–∏–∏
   - ‚úÖ –í production –æ–±—Ä–∞–∑ –ø–æ–ø–∞–¥–∞—é—Ç —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ–∞–π–ª—ã

2. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**
   - ‚úÖ `npm ci --omit=dev` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ production –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
   - ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `wait-on` –≤ production dependencies –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã
   - ‚úÖ Prisma Client –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –∏–∑ builder-—Å—Ç–∞–¥–∏–∏

3. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**
   - ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –Ω–µ–ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å `USER node`
   - ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º
   - ‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–æ–¥ root

4. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**
   - ‚úÖ –°–æ–∑–¥–∞–Ω `.dockerignore` –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è –Ω–µ–Ω—É–∂–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
   - ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ª–æ–µ–≤ Docker –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ
   - ‚úÖ –£–º–µ–Ω—å—à–µ–Ω —Ä–∞–∑–º–µ—Ä —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞

5. **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø—É—Å–∫–∞**
   - ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω entrypoint –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `prisma db push`
   - ‚úÖ –£—Å—Ç—Ä–∞–Ω–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞
   - ‚úÖ Wait-on –±–æ–ª—å—à–µ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏

## üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ Dockerfile:

```dockerfile
# ---------- builder stage ----------
FROM node:20-alpine AS builder
WORKDIR /app

# Install OpenSSL (needed for Prisma in Alpine)
RUN apk add --no-cache openssl

# Copy package files first to leverage Docker cache
COPY package*.json ./
RUN npm ci  # All dependencies for building

# Copy source and build
COPY prisma ./prisma
COPY tsconfig*.json ./
COPY src ./src
RUN npx prisma generate
RUN npx tsc -b

# ---------- production/runtime stage ----------
FROM node:20-alpine AS runtime
WORKDIR /app

# Install runtime dependencies only
RUN apk add --no-cache openssl wget
COPY package*.json ./
RUN npm ci --omit=dev  # Production dependencies only

# Copy built files and Prisma client
COPY --from=builder /app/dist ./dist
COPY --from=builder /app/prisma ./prisma
COPY --from=builder /app/node_modules/@prisma ./node_modules/@prisma
COPY --from=builder /app/node_modules/.prisma ./node_modules/.prisma

# Setup entrypoint and permissions
COPY docker-entrypoint.sh /usr/local/bin/docker-entrypoint.sh
RUN chmod +x /usr/local/bin/docker-entrypoint.sh
RUN chown -R node:node /app

# Security: use non-root user
USER node

ENTRYPOINT ["sh", "/usr/local/bin/docker-entrypoint.sh"]
CMD ["node", "dist/src/index.js"]
```

## üì¶ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:

### `.dockerignore`
```
node_modules
dist
.env
.env.local
.vscode
.git
*.log
coverage
README.md
*.md
```

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π `package.json`
```json
{
  "dependencies": {
    "@prisma/client": "^5.22.0",
    "cors": "^2.8.5",
    "dotenv": "^16.3.1",
    "express": "^4.21.2",
    "helmet": "^7.2.0",
    "wait-on": "^9.0.1",  // ‚Üê –î–æ–±–∞–≤–ª–µ–Ω–æ
    "zod": "^3.25.76"
  }
}
```

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

### ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏:
- **API –¥–æ—Å—Ç—É–ø–µ–Ω**: http://localhost:3001/api/todos ‚úÖ
- **–°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞**: 200 OK ‚úÖ
- **–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è**: –¢–µ—Å—Ç–æ–≤–∞—è –∑–∞–¥–∞—á–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è ‚úÖ
- **Prisma Client —Ä–∞–±–æ—Ç–∞–µ—Ç**: –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑ builder —É—Å–ø–µ—à–Ω–æ ‚úÖ

### ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å**: `node` (UID 1000) ‚úÖ
- **–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞**: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã ‚úÖ
- **Root –¥–æ—Å—Ç—É–ø**: –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç ‚úÖ

### ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –æ–±—Ä–∞–∑–∞:
```bash
# Prisma Client –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç
/app/node_modules/@prisma/client/ ‚úÖ
/app/node_modules/.prisma/ ‚úÖ

# Dev-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤ production
# –†–∞–∑–º–µ—Ä –æ–±—Ä–∞–∑–∞ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω
```

## üîÑ –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã:

### –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞:
```bash
cd C:\Users\KADYR\Desktop\–ö—É—Ä—Å\todo-app
docker compose build --no-cache api
```

### –ó–∞–ø—É—Å–∫:
```bash
docker compose up -d
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞:
```bash
# –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker compose ps

# –õ–æ–≥–∏ API
docker compose logs api --tail=20

# –¢–µ—Å—Ç API
Invoke-WebRequest -Uri "http://localhost:3001/api/todos" -Method GET
```

## üìä –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏:

1. **üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–¥ root
2. **üì¶ –†–∞–∑–º–µ—Ä**: –ú–µ–Ω—å—à–∏–π —Ä–∞–∑–º–µ—Ä –∏–∑-–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è dev-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
3. **‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ª–æ–µ–≤
4. **üõ°Ô∏è –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å**: –ù–µ—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö —É—Å—Ç–∞–Ω–æ–≤–æ–∫ –ø–∞–∫–µ—Ç–æ–≤
5. **üßπ –ß–∏—Å—Ç–æ—Ç–∞**: `.dockerignore` –∏—Å–∫–ª—é—á–∞–µ—Ç –Ω–µ–Ω—É–∂–Ω—ã–µ —Ñ–∞–π–ª—ã
6. **üîß –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç—å**: –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ production

## üéâ –ì–û–¢–û–í–û!

–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π Docker –æ–±—Ä–∞–∑ —Å–æ–∑–¥–∞–Ω –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω. –í—Å–µ —Å–∏—Å—Ç–µ–º—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é.

---
**–î–∞—Ç–∞**: 7 –æ–∫—Ç—è–±—Ä—è 2025 –≥.  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ü–û–õ–ù–û–°–¢–¨–Æ –û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–û